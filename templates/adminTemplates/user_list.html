{% extends 'adminTemplates/base.html' %}
{% load static %}

{% block content %}
<style>
    .userType {
        display: none;
    }
</style>
{% if messages %}
<script>
    let successMessages = [];
    let errorMessages = [];

    "{% for message in messages %}"
    "{% if message.tags == 'success' %}"
    successMessages.push('{{ message }}');
    "{% elif message.tags == 'error' %}"
    errorMessages.push('{{ message }}');
    "{% endif %}"
    "{% endfor %}"

    if (successMessages.length > 0) {
        Swal.fire({
            icon: 'success',
            title: successMessages.join('<br>'),  // Concatenate messages with a line break
            showConfirmButton: false,
            timer: 2000
        });
    }

    if (errorMessages.length > 0) {
        Swal.fire({
            icon: 'error',
            title: 'Oops..',
            html: errorMessages.join('<br>'),  // Concatenate messages with a line break
            showCloseButton: true
        });
    }
</script>
{% endif %}
<!-- begin: container -->
<div class="container-fixed" id="content_container">
</div>
<!-- end: container -->
<!-- begin: container -->
<div class="container-fixed pb-7">
    <div class="flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5">
        <div class="flex flex-col justify-center gap-2">
            {% if request.user.user_type == 'Vendor' %}
            <h1 class="text-xl font-semibold leading-none text-gray-900">
                Drivers
            </h1>
            {% else %}
            <h1 class="text-xl font-semibold leading-none text-gray-900">
                Users
            </h1>
            {% endif %}
            <div class="flex items-center gap-2 text-sm font-medium text-gray-600">
                View, Add, Edit and Delete Users
            </div>
        </div>
        <div class="flex items-center gap-2.5">
            {% if request.user.user_type == 'Vendor' %}
            <button class="btn btn-sm btn-light" data-collapse="#collapsible_content">
                Add Driver
            </button>
            {% else %}
            <button class="btn btn-sm btn-light" data-collapse="#collapsible_content">
                Add Users
            </button>
            {% endif %}
        </div>
    </div>
    <div class="card transition-all hidden container-fixed" id="collapsible_content">
        <div class="card-header" id="basic_settings">
            {% if request.user.user_type == 'Vendor' %}
            <h3 class="card-title">
                Create Driver
            </h3>
            {% else %}
            <h3 class="card-title">
                Create User
            </h3>
            {% endif %}
        </div>
        <form method="post" id="UserCreateForm">
            <div class="card-body grid gap-5">
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for='first_name' class="form-label flex items-center gap-1 max-w-56">
                            First Name
                        </label>
                        <input class="input" id="first_name" type="text" name="first_name"
                            placeholder="Enter your Name" />
                    </div>
                </div>
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for='last_name' class="form-label flex items-center gap-1 max-w-56">
                            Last Name
                        </label>
                        <input class="input" id="last_name" type="text" name="last_name"
                            placeholder="Enter your Name" />
                    </div>
                </div>
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for="email" class="form-label flex items-center gap-1 max-w-56">
                            Email
                            <span class="text-danger">
                                *
                            </span>
                        </label>
                        <input class="input" id="email" name="email" placeholder="Enter email address" type="email" />
                    </div>
                </div>
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for="phone" class="form-label flex items-center gap-1 max-w-56">
                            Phone number
                            <span class="text-danger">
                                *
                            </span>
                        </label>
                        <input class="input" placeholder="Enter Phone Number" type="tel" id="phone" name="phone"
                            pattern="[0-9]{10}" required maxlength="10" />
                    </div>
                </div>
                {% if not request.user.user_type == 'Vendor' %}
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label class="form-label flex items-center gap-1 max-w-56">
                            User Type
                            <span class="text-danger">
                                *
                            </span>
                        </label>
                        <label class="form-label">
                            <input class="radio" name="user_type" type="radio" value="Vendor" checked /> Vendor
                        </label>
                        <label class="form-label">
                            <input class="radio" id="adminRadio" name="user_type" type="radio" value="Admin" /> Admin
                        </label>
                        <label class="form-label">
                            <input class="radio" name="user_type" type="radio" value="Driver" /> Driver
                        </label>
                    </div>
                </div>
                <div class="w-full userType" id="userType1">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for="password" class="form-label flex items-center gap-1 max-w-56">
                            Password
                            <span class="text-danger">
                                *
                            </span>
                        </label>
                        <div class="input max-w-72" data-toggle-password="true" data-toggle-password-permanent="true">
                            <input placeholder="Password" type="password" name="password" id="password" required />
                            <div class="btn btn-icon" data-toggle-password-trigger="true">
                                <i class="ki-outline ki-eye toggle-password-active:hidden">
                                </i>
                                <i class="ki-outline ki-eye-slash hidden toggle-password-active:block">
                                </i>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="flex justify-center pt-2.5">
                    <span class="badge badge-bg badge-outline badge-warning">
                        More Details Optional
                    </span>
                </div>
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for="photo" class="form-label flex items-center gap-1 max-w-56">
                            Photo
                        </label>
                        <input class="file-input" id="photo" name="photo" accept="image/*" type="file" />
                        <p id="photo-name-display"></p>
                    </div>
                </div>
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label class="form-label flex items-center gap-1 max-w-56">
                            Gender
                        </label>
                        <div class="flex flex-col w-full gap-1">
                            <select class="select" name="gender" id="gender">
                                <option disabled selected>Select an option</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                {% if not request.user.user_type == 'Vendor' %}
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label class="form-label flex items-center gap-1 max-w-56">
                            Works For
                        </label>
                        <div class="flex flex-col w-full gap-1">
                            <select class="select" name="works_for" id="works_for">
                                <option value="" selected>Select an option</option>
                                {% if works_for %}
                                {% for user in works_for %}
                                <option value="{{ user.pk }}">
                                    {{ user }}
                                </option>
                                {% endfor %}
                                {% else %}
                                <option value="">
                                    None
                                </option>
                                {% endif %}
                            </select>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="w-full">
                    <div class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                        <label for="join_date" class="form-label flex items-center gap-1 max-w-56">
                            Join Date
                        </label>
                        <input id="join_date" name="join_date" type="date" />
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-5">
                    <div class="form-group ms-5">
                        <label for="aadhar_card" class="form-label">Aadhar Card</label>
                        <input class="form-control-file form-control-sm" id="aadhar_card" type="file" name="aadhar_card"
                            accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="driving_licence" class="form-label">Driving Licence</label>
                        <input class="form-control-file form-control-sm" id="driving_licence" type="file"
                            name="driving_licence" accept="image/*">
                    </div>
                </div>

                <div class="flex justify-end pt-2.5">
                    <button type="submit" class="btn btn-primary" style="background-color: #00b0c3; color: white;">
                        Create
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- end: container -->
<div class="container-fixed">
    <div class="grid gap-5 lg:gap-7.5">
        <div class="card card-grid min-w-full">
            <div class="card-header py-5 flex-wrap">
                <h3 class="card-title">
                    {% if request.user.user_type == 'Vendor' %}
                    My Drivers
                    {% else %}
                    Vahan users
                    {% endif %}
                    <div style="display: inline-block;" class="ml-5">
                        <button class="btn btn-danger btn-sm" type="button" onclick="userdelete()">
                            <i class="ki-filled ki-trash"></i>
                            Delete
                        </button>
                    </div>
                </h3>
                <div class="flex gap-6">
                    <div class="relative">
                        <i
                            class="ki-outline ki-magnifier leading-none text-md text-gray-500 absolute top-1/2 left-0 -translate-y-1/2 ml-3">
                        </i>
                        <input class="input input-sm pl-8" onkeyup="filterTable()" placeholder="Search Users"
                            id="searchUser" type="text" />
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div data-datatable="true" data-datatable-page-size="5">
                    <div class="scrollable-x-auto">
                        <table class="table table-auto table-border" data-datatable-table="true" id="user_account_table">
                            <thead>

                                <tr>
                                    <th class="w-[60px]">
                                        <input class="checkbox checkbox-sm" data-datatable-check="true"
                                            type="checkbox" />
                                    </th>
                                    <th class="w-[80px]">
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                User Type
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[175px]">
                                        <span class="sort asc">
                                            <span class="sort-label">
                                                Name
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[150px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Email
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Phone Number
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Gender
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Join Date
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Exit Date
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Works For
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Created By
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Created At
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Updated By
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Updated At
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Last Login
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Aadhar
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                    <th class="min-w-[125px]">
                                        <span class="sort">
                                            <span class="sort-label">
                                                Driving Licence
                                            </span>
                                            <span class="sort-icon">
                                            </span>
                                        </span>
                                    </th>
                                </tr>

                            </thead>
                            <tbody>
                                {% if users %}
                                {% for user in users %}
                                {% with user.accountDetail.first as detail %}
                                <tr>
                                    <td>
                                        <input class="checkbox checkbox-sm" data-datatable-row-check="true"
                                            type="checkbox" id="checkBOX" value="{{ user.pk }}" />
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-light"
                                            data-modal-toggle="#userUpdateModal-{{ user.pk }}">
                                            Edit
                                        </button>
                                    </td>
                                    {% if user.user_type == 'Admin' %}
                                    <td>
                                        <span class="badge badge-sm badge-outline badge-warning">
                                            {{ user.user_type }}
                                        </span>
                                    </td>
                                    {% endif %}
                                    {% if user.user_type == 'Vendor' %}
                                    <td>
                                        <span class="badge badge-sm badge-outline badge-primary">
                                            {{ user.user_type }}
                                        </span>
                                    </td>
                                    {% endif %}
                                    {% if user.user_type == 'Driver' %}
                                    <td>
                                        <span class="badge badge-sm badge-outline badge-danger">
                                            {{ user.user_type }}
                                        </span>
                                    </td>
                                    {% endif %}
                                    {% if user.user_type == 'Customer' %}
                                    <td>
                                        <span class="badge badge-sm badge-outline badge-info">
                                            {{ user.user_type }}
                                        </span>
                                    </td>
                                    {% endif %}
                                    <td>
                                        <div class="flex items-center gap-2.5">
                                            {% if detail.photo %}
                                            <img alt="" class="size-11 rounded-full shrink-0"
                                                src="{{ detail.photo.url }}">
                                            </img>
                                            {% else %}
                                            <img alt="" class="h-9 rounded-full"
                                                src="{% static 'media/avatars/blank.png' %}" />
                                            {% endif %}
                                            <div class="flex flex-col gap-0.5">
                                                <a class="leading-none font-semibold text-sm text-gray-900 hover:text-primary"
                                                    href="#">
                                                    {{ user.first_name }} {{ user.last_name }}
                                                </a>
                                                <span class="text-2sm text-gray-600">
                                                    <hr style="height: 1rem;">
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-1.5">
                                            <img alt="flag" class="h-4 rounded-full"
                                                src="{% static 'media/brand-logos/gmail-icon.svg' %}" />
                                            <span class="leading-none text-gray-700">
                                                {{ user.email }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>

                                        {{ user.phone_number }}

                                    </td>
                                    <td>

                                        {{ detail.gender }}

                                    </td>
                                    <td>

                                        {{ detail.join_date }}

                                    </td>
                                    <td>

                                        {{ detail.exit_date }}

                                    </td>
                                    {% if detail.works_for.first_name != '' and detail.works_for.last_name != '' %}
                                    <td>

                                        {{ detail.works_for.first_name }} {{ detail.works_for.last_name }}

                                    </td>
                                    {% else %}
                                    <td>

                                        {{ detail.works_for.email }}

                                    </td>
                                    {% endif %}
                                    {% if detail.created_by.first_name != '' and detail.created_by.last_name != '' %}
                                    <td>

                                        {{ detail.created_by.first_name }} {{ detail.created_by.last_name }}

                                    </td>
                                    {% else %}
                                    <td>

                                        {{ detail.created_by.email }}

                                    </td>
                                    {% endif %}
                                    <td>

                                        {{ user.created_at }}

                                    </td>
                                    {% if detail.updated_by.first_name != '' and detail.updated_by.last_name != '' %}
                                    <td>

                                        {{ detail.updated_by.first_name }} {{ detail.updated_by.last_name }}

                                    </td>
                                    {% else %}
                                    <td>

                                        {{ detail.updated_by.email }}

                                    </td>
                                    {% endif %}
                                    <td>

                                        {{ user.updated_at }}

                                    </td>
                                    <td>

                                        {{ user.last_login }}

                                    </td>
                                    {% if detail.aadhar_card %}
                                    <td>
                                        <a class="btn btn-link" href="{{ detail.aadhar_card.url }}" download>
                                            Download
                                        </a>
                                        <span class="btn text-primary" data-modal-toggle="#modal_aadhar-{{user.pk}}">
                                            View
                                        </span>

                                    </td>
                                    {% else %}
                                    <td>

                                        N/A

                                    </td>
                                    {% endif %}
                                    {% if detail.driving_licence %}
                                    <td>
                                        <a class="btn btn-link" href="{{ detail.driving_licence.url }}" download>
                                            Download
                                        </a>
                                        <span class="btn text-primary" data-modal-toggle="#modal_driving_licence-{{user.pk}}">
                                            View
                                        </span>

                                    </td>
                                    {% else %}
                                    <td>

                                        N/A

                                    </td>
                                    {% endif %}
                                </tr>
                                <div class="modal" data-modal="true" id="userUpdateModal-{{ user.pk }}"
                                    data-modal-backdrop-static="true">
                                    <div class="modal-content max-w-[600px] top-[10%]">
                                        <div class="modal-header">
                                            <h3 class="modal-title">
                                                Update User Details
                                            </h3>
                                            <button class="btn btn-xs btn-icon btn-light" data-modal-dismiss="true">
                                                <i class="ki-outline ki-cross">
                                                </i>
                                            </button>
                                        </div>
                                        <form method="POST" id="userUpdateForm"
                                            action="{% url 'user-update' pk=user.pk %}" enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <div class="modal-body">
                                                <div class="card-body grid gap-5">
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for='fnameU'
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                First Name
                                                            </label>
                                                            <input class="input" id="fnameU" type="text"
                                                                value="{{ user.first_name }}" name="new_fname"
                                                                placeholder="Enter your first name" />
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for='lnameU'
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Last Name
                                                            </label>
                                                            <input class="input" id="lnameU" type="text"
                                                                value="{{ user.last_name }}" name="new_lname"
                                                                placeholder="Enter your last name" />
                                                        </div>
                                                    </div>
                                                    <input type="hidden" id="userId" value="{{ user.pk }}">
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="emailU"
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Email
                                                                <span class="text-danger">
                                                                    *
                                                                </span>
                                                            </label>
                                                            <input class="input" id="emailU" value="{{ user.email }}"
                                                                name="new_email" placeholder="Enter email address"
                                                                type="email" />
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="phoneU"
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Phone number
                                                                <span class="text-danger">
                                                                    *
                                                                </span>
                                                            </label>
                                                            <input class="input" placeholder="Enter Phone Number"
                                                                value="{{ user.phone_number }}" type="tel" id="phoneU"
                                                                name="new_phone" pattern="[0-9]{10}" required
                                                                maxlength="10" />
                                                        </div>
                                                    </div>
                                                    {% if user.user_type != "Customer" %}
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label class="form-label flex items-center gap-1 max-w-56">
                                                                Gender
                                                            </label>
                                                            <div class="flex flex-col w-full gap-1">
                                                                <select class="select" name="new_gender" id="genderU">

                                                                    {% if detail.gender %}
                                                                        <option selected value="{{ detail.gender }}">{{ detail.gender }}</option>
                                                                        {% for value, label in gender_choices %}
                                                                            {% if detail.gender != value %}
                                                                            <option value="{{ value }}">{{ label }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                        {% else %}
                                                                            <option disabled selected>Select an option</option>
                                                                            {% for value, label in gender_choices %}
                                                                            <option value="{{ value }}">{{ label }}</option>
                                                                            {% endfor %}
                                                                    {% endif %}


                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% if not request.user.user_type == 'Vendor' %}
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label class="form-label flex items-center gap-1 max-w-56">
                                                                Works For
                                                            </label>
                                                            <div class="flex flex-col w-full gap-1">
                                                                <select class="select" name="new_works_for"
                                                                    id="new_works_forU">
                                                                    {% with user.accountDetail.first as detail %}
                                                                        {% if detail.works_for %}
                                                                        <option value="{{ detail.works_for.id }}" selected>
                                                                            {{ detail.works_for.email }}</option>
                                                                        {% else %}
                                                                        <option value="" selected>Select a option</option>
                                                                        {% endif %}
                                                                    {% endwith %}
                                                                    {% if works_for %}
                                                                        {% for users in works_for %}
                                                                            {% if users.pk != detail.works_for.id and users.pk != user.pk %}
                                                                                <option value="{{ users.pk }}">
                                                                                    {{ users }}
                                                                                </option>
                                                                            {% endif %}
                                                                        {% endfor %}

                                                                    {% endif %}
                                                                    <option value="">None</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}

                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="photoU"
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Photo
                                                            </label>
                                                            <input class="file-input" id="photoU" name="new_photo"
                                                                accept="image/*" type="file" />
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="aadhar_cardU"
                                                                class="form-label flex items-center gap-1 max-w-56">Aadhar
                                                                Card</label>
                                                            <input class="form-control-file form-control-sm"
                                                                id="aadhar_cardU" type="file" name="new_aadhar_card"
                                                                accept="image/*">
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="driving_licenceU"
                                                                class="form-label flex items-center gap-1 max-w-56">Driving
                                                                Licence</label>
                                                            <input class="form-control-file form-control-sm"
                                                                id="driving_licenceU" type="file"
                                                                name="new_driving_licence" accept="image/*">
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="join_dateU"
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Join Date
                                                            </label>
                                                            <input id="join_dateU" name="new_join_date" type="date"
                                                                value="" />
                                                        </div>
                                                    </div>
                                                    <div class="w-full">
                                                        <div
                                                            class="flex items-baseline flex-wrap lg:flex-nowrap gap-2.5">
                                                            <label for="exit_dateU"
                                                                class="form-label flex items-center gap-1 max-w-56">
                                                                Exit Date
                                                            </label>
                                                            <input id="exit_dateU" name="new_exit_date" type="date" />
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="modal-footer">
                                                <div class="flex justify-end pt-2.5">
                                                    <button class="btn btn-primary mr-2 mb-2" type="submit" style="background-color: #00b0c3; color: white;">
                                                        Submit
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="modal" data-modal="true" id="modal_aadhar-{{user.pk}}">
                                    <div class="modal-content max-w-[600px] top-[20%]">
                                        <div class="modal-header">
                                            <h3 class="modal-title">
                                                Aadhar Card
                                            </h3>
                                            <button class="btn btn-xs btn-icon btn-light" data-modal-dismiss="true">
                                                <i class="ki-outline ki-cross">
                                                </i>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% with user.accountDetail.first as detail %}
                                                {% if detail.aadhar_card %}
                                                <img style="display: block;margin: auto; width: 50%;height: 50%;" alt="Aadhar Card" src="{{ detail.aadhar_card.url }}">
                                                </img>
                                                {% else %}
                                                    Aadhar Card Not Found
                                                {% endif %}
                                            {% endwith %}
                                        </div>
                                    </div>
                                </div>
                                <div class="modal" data-modal="true" id="modal_driving_licence-{{user.pk}}">
                                    <div class="modal-content max-w-[600px] top-[20%]">
                                        <div class="modal-header">
                                            <h3 class="modal-title">
                                                Driving Licence
                                            </h3>
                                            <button class="btn btn-xs btn-icon btn-light" data-modal-dismiss="true">
                                                <i class="ki-outline ki-cross">
                                                </i>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% with user.accountDetail.first as detail %}
                                                {% if detail.driving_licence %}
                                                <img style="display: block;margin: auto; width: 50%;height: 50%;" alt="Aadhar Card" src="{{ detail.driving_licence.url }}">
                                                </img>
                                                {% else %}
                                                Driving licence Not Found
                                                {% endif %}
                                            {% endwith %}
                                        </div>
                                    </div>
                                </div>
                                {% endwith %}
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td>
                                        <input class="checkbox checkbox-sm" data-datatable-row-check="true"
                                            type="checkbox" id="nullCheckBox" value="null" />
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-light">
                                            Edit
                                        </button>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-2.5">
                                            <div class="flex flex-col gap-0.5">
                                                N/A
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-1.5">
                                            <span class="leading-none text-gray-700">
                                                N/A
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                    <td>
                                        <span class="leading-none text-gray-700">
                                            N/A
                                        </span>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <div
                        class="card-footer justify-center md:justify-between flex-col md:flex-row gap-3 text-gray-600 text-2sm font-medium">
                        <div class="flex items-center gap-2">
                            Show
                            <select class="select select-sm w-16" data-datatable-size="true" name="perpage">
                            </select>
                            per page
                        </div>
                        <div class="flex items-center gap-4">
                            <span data-datatable-info="true">
                            </span>
                            <div class="pagination" data-datatable-pagination="true">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>


    // filter search script start
    function filterTable() {
        // Get the value of the input field
        var input = document.getElementById('searchUser');
        var filter = input.value.toUpperCase();
        var table = document.getElementById('user_account_table');
        var tr = table.getElementsByTagName('tr');

        // Loop through all table rows, and hide those who don't match the search query
        for (var i = 1; i < tr.length; i++) {
            var tdName = tr[i].getElementsByTagName('td')[3];
            if (tdName) {
                var txtValueName = tdName.textContent || tdName.innerText;
                if (txtValueName.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = '';
                } else {
                    tr[i].style.display = 'none';
                }
            }
        }
    }
    // end 


    function userdelete() {
        const checkboxes = document.querySelectorAll('#user_account_table input[id="checkBOX"]');
        // Filter the checked checkboxes
        const checkedCheckboxes = Array.from(checkboxes).filter(checkbox => checkbox.checked);
        if (checkedCheckboxes[0]) {

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {

                    // Extract values of checked checkboxes
                    const checkedValues = checkedCheckboxes.map(checkbox => checkbox.value);

                    if (checkedValues != '') {

                        $.ajax({
                            type: 'GET',
                            url: '/user/delete/',
                            data: {
                                'user_list': checkedValues,
                            },
                            success: function (response) {
                                if (response.error) {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Oops..',
                                        text: 'Something Went Wrong.',
                                        showCloseButton: true
                                    });
                                } else {
                                    Swal.fire({
                                        title: "Deleted!",
                                        text: "User has been deleted.",
                                        icon: "success"
                                    });

                                    setTimeout(function () {
                                        location.reload();
                                    }, 2000);
                                    $('#UserCreateForm')[0].reset();
                                }
                            },
                            error: function (error) {
                                Swal.fire({
                                        icon: 'error',
                                        title: 'Oops..',
                                        text: 'Something Went Wrong.',
                                        showCloseButton: true
                                    });
                            }
                        });
                    }

                }
            });
        }

    }


    document.addEventListener('DOMContentLoaded', function () {

        //start
        // this toggles the password block only if the radio button is on admin type
        const adminRadio = document.getElementById('adminRadio');
        const userType1 = document.getElementById('userType1');

        if (adminRadio) {
            adminRadio.addEventListener('change', function () {
                if (adminRadio.checked) {
                    userType1.style.display = 'block';
                }
            });

            const radios = document.querySelectorAll('input[name="user_type"]');
            radios.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (!adminRadio.checked) {
                        userType1.style.display = 'none';
                    }
                });
            });
        }
        // end

        //start
        // to toggle required attribute only for admin type
        function togglePasswordRequired() {
            var userType = $('input[name="user_type"]:checked').val();
            var passwordField = $('#password');

            if (userType === 'Admin') {
                passwordField.attr('required', 'required');
            } else {
                passwordField.removeAttr('required');
            }
        }

        // Call the function on page load to set the initial state
        togglePasswordRequired();

        // Call the function whenever a radio button is changed
        $('input[name="user_type"]').change(function () {
            togglePasswordRequired();
        });
        //end

        //start
        //ajax form submission to create user
        let userCreateFrmElement = document.getElementById("UserCreateForm")
        if (userCreateFrmElement) {
            // Add event listener to the form submission
            document.getElementById("UserCreateForm").addEventListener("submit", function (event) {
                // Check if the form is valid
                if (!this.checkValidity()) {
                    // If the form is not valid, prevent the default form submission
                    event.preventDefault();
                    // Trigger HTML5 form validation to display validation messages
                    this.reportValidity();
                } else {
                    // If the form is valid, proceed with AJAX submission
                    event.preventDefault(); // Prevent default submission

                    let formData = new FormData(this);
                    let user_Type = "{{ request.user.user_type }}";
                    let urlstr = "";
                    if (user_Type == "Admin") {
                        urlstr = '/admin-home/user-list/';
                    }

                    if (user_Type == "Vendor") {
                        urlstr = '/vendor/driver-list/';
                    }
                    $.ajax({
                        type: 'POST',
                        url: urlstr,
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                        success: function (response) {
                            if (response.error) {
                                // Create an empty string to hold all the error messages
                                let errorMessage = '';

                                // Loop through the errors object and append each error message
                                $.each(response.error, function (key, value) {
                                    errorMessage += key.charAt(0).toUpperCase() + key.slice(1) + ": " + value + "\n";
                                });
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops..',
                                    text: errorMessage,
                                    showCloseButton: true
                                });
                            } else {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'User Added',
                                    showConfirmButton: false,
                                    timer: 2000
                                });

                                setTimeout(function () {
                                    location.reload();
                                }, 2000);
                                $('#UserCreateForm')[0].reset();
                            }
                        },
                        error: function (error) {
                            Swal.fire({
                                        icon: 'error',
                                        title: 'Oops..',
                                        text: 'Something Went Wrong.',
                                        showCloseButton: true
                                });
                        }
                    });
                }


            });
        }
        //end
    });


</script>

{% endblock %}